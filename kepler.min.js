var KEPLER={VERSION:"0.0.7",UNIT_LENGTH:"meter"};KEPLER.MAX_SAFE_LENGTH=Number.MAX_SAFE_INTEGER;KEPLER.KILOMETER=KEPLER.KM=1E3;KEPLER.AU=1496E8;KEPLER.LIGHT_SECOND=2998E5;KEPLER.LIGHT_MINUTE=1799E7;KEPLER.LIGHT_HOUR=1079E9;KEPLER.LIGHT_DAY=259E11;KEPLER.LIGHT_YEAR=9461E12;KEPLER.UNIT_TIME="second";KEPLER.MAX_SAFE_TIME=Number.MAX_SAFE_INTEGER;KEPLER.MINUTE=60;KEPLER.HOUR=3600;KEPLER.DAY=86400;KEPLER.YEAR=3154E4;KEPLER.UNIT_ROTATION="Radians";KEPLER.DEGREE=.0174533;KEPLER.PI=Math.PI;
KEPLER.DEGREES_PER_DAY=KEPLER.DEGREE/KEPLER.DAY;KEPLER.UNIT_mass="Kilograms";KEPLER.TONNE=KEPLER.TON=1E3;KEPLER.EARTH_MASS=5.974E24;KEPLER.SOL_MASS=1.9891E30;KEPLER.G=6.674E-11;var THREE={REVISION:"74",Matrix4:function(){this.elements=new Float32Array([1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1]);0<arguments.length&&console.error("THREE.Matrix4: the constructor no longer reads arguments. use .set() instead.")}};
THREE.Matrix4.prototype={constructor:THREE.Matrix4,set:function(a,b,c,d,e,g,f,h,k,l,m,n,p,q,t,u){var r=this.elements;r[0]=a;r[4]=b;r[8]=c;r[12]=d;r[1]=e;r[5]=g;r[9]=f;r[13]=h;r[2]=k;r[6]=l;r[10]=m;r[14]=n;r[3]=p;r[7]=q;r[11]=t;r[15]=u;return this},identity:function(){this.set(1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1);return this},clone:function(){return(new THREE.Matrix4).fromArray(this.elements)},copy:function(a){this.elements.set(a.elements);return this},copyPosition:function(a){var b=this.elements;a=a.elements;
b[12]=a[12];b[13]=a[13];b[14]=a[14];return this},extractBasis:function(a,b,c){var d=this.elements;a.set(d[0],d[1],d[2]);b.set(d[4],d[5],d[6]);c.set(d[8],d[9],d[10]);return this},makeBasis:function(a,b,c){this.set(a.x,b.x,c.x,0,a.y,b.y,c.y,0,a.z,b.z,c.z,0,0,0,0,1);return this},extractRotation:function(){var a;return function(b){void 0===a&&(a=new THREE.Vector3);var c=this.elements;b=b.elements;var d=1/a.set(b[0],b[1],b[2]).length(),e=1/a.set(b[4],b[5],b[6]).length(),g=1/a.set(b[8],b[9],b[10]).length();
c[0]=b[0]*d;c[1]=b[1]*d;c[2]=b[2]*d;c[4]=b[4]*e;c[5]=b[5]*e;c[6]=b[6]*e;c[8]=b[8]*g;c[9]=b[9]*g;c[10]=b[10]*g;return this}}(),makeRotationFromEuler:function(a){!1===a instanceof THREE.Euler&&console.error("THREE.Matrix: .makeRotationFromEuler() now expects a Euler rotation rather than a Vector3 and order.");var b=this.elements,c=a.x,d=a.y,e=a.z,g=Math.cos(c),c=Math.sin(c),f=Math.cos(d),d=Math.sin(d),h=Math.cos(e),e=Math.sin(e);if("XYZ"===a.order){a=g*h;var k=g*e,l=c*h,m=c*e;b[0]=f*h;b[4]=-f*e;b[8]=
d;b[1]=k+l*d;b[5]=a-m*d;b[9]=-c*f;b[2]=m-a*d;b[6]=l+k*d;b[10]=g*f}else"YXZ"===a.order?(a=f*h,k=f*e,l=d*h,m=d*e,b[0]=a+m*c,b[4]=l*c-k,b[8]=g*d,b[1]=g*e,b[5]=g*h,b[9]=-c,b[2]=k*c-l,b[6]=m+a*c,b[10]=g*f):"ZXY"===a.order?(a=f*h,k=f*e,l=d*h,m=d*e,b[0]=a-m*c,b[4]=-g*e,b[8]=l+k*c,b[1]=k+l*c,b[5]=g*h,b[9]=m-a*c,b[2]=-g*d,b[6]=c,b[10]=g*f):"ZYX"===a.order?(a=g*h,k=g*e,l=c*h,m=c*e,b[0]=f*h,b[4]=l*d-k,b[8]=a*d+m,b[1]=f*e,b[5]=m*d+a,b[9]=k*d-l,b[2]=-d,b[6]=c*f,b[10]=g*f):"YZX"===a.order?(a=g*f,k=g*d,l=c*f,m=
c*d,b[0]=f*h,b[4]=m-a*e,b[8]=l*e+k,b[1]=e,b[5]=g*h,b[9]=-c*h,b[2]=-d*h,b[6]=k*e+l,b[10]=a-m*e):"XZY"===a.order&&(a=g*f,k=g*d,l=c*f,m=c*d,b[0]=f*h,b[4]=-e,b[8]=d*h,b[1]=a*e+m,b[5]=g*h,b[9]=k*e-l,b[2]=l*e-k,b[6]=c*h,b[10]=m*e+a);b[3]=0;b[7]=0;b[11]=0;b[12]=0;b[13]=0;b[14]=0;b[15]=1;return this},makeRotationFromQuaternion:function(a){var b=this.elements,c=a.x,d=a.y,e=a.z,g=a.w,f=c+c,h=d+d,k=e+e;a=c*f;var l=c*h,c=c*k,m=d*h,d=d*k,e=e*k,f=g*f,h=g*h,g=g*k;b[0]=1-(m+e);b[4]=l-g;b[8]=c+h;b[1]=l+g;b[5]=1-(a+
e);b[9]=d-f;b[2]=c-h;b[6]=d+f;b[10]=1-(a+m);b[3]=0;b[7]=0;b[11]=0;b[12]=0;b[13]=0;b[14]=0;b[15]=1;return this},lookAt:function(){var a,b,c;return function(d,e,g){void 0===a&&(a=new THREE.Vector3);void 0===b&&(b=new THREE.Vector3);void 0===c&&(c=new THREE.Vector3);var f=this.elements;c.subVectors(d,e).normalize();0===c.lengthSq()&&(c.z=1);a.crossVectors(g,c).normalize();0===a.lengthSq()&&(c.x+=1E-4,a.crossVectors(g,c).normalize());b.crossVectors(c,a);f[0]=a.x;f[4]=b.x;f[8]=c.x;f[1]=a.y;f[5]=b.y;f[9]=
c.y;f[2]=a.z;f[6]=b.z;f[10]=c.z;return this}}(),multiply:function(a,b){return void 0!==b?(console.warn("THREE.Matrix4: .multiply() now only accepts one argument. Use .multiplyMatrices( a, b ) instead."),this.multiplyMatrices(a,b)):this.multiplyMatrices(this,a)},multiplyMatrices:function(a,b){var c=a.elements,d=b.elements,e=this.elements,g=c[0],f=c[4],h=c[8],k=c[12],l=c[1],m=c[5],n=c[9],p=c[13],q=c[2],t=c[6],u=c[10],r=c[14],w=c[3],v=c[7],x=c[11],c=c[15],y=d[0],z=d[4],A=d[8],B=d[12],C=d[1],D=d[5],E=
d[9],F=d[13],G=d[2],H=d[6],I=d[10],J=d[14],K=d[3],L=d[7],M=d[11],d=d[15];e[0]=g*y+f*C+h*G+k*K;e[4]=g*z+f*D+h*H+k*L;e[8]=g*A+f*E+h*I+k*M;e[12]=g*B+f*F+h*J+k*d;e[1]=l*y+m*C+n*G+p*K;e[5]=l*z+m*D+n*H+p*L;e[9]=l*A+m*E+n*I+p*M;e[13]=l*B+m*F+n*J+p*d;e[2]=q*y+t*C+u*G+r*K;e[6]=q*z+t*D+u*H+r*L;e[10]=q*A+t*E+u*I+r*M;e[14]=q*B+t*F+u*J+r*d;e[3]=w*y+v*C+x*G+c*K;e[7]=w*z+v*D+x*H+c*L;e[11]=w*A+v*E+x*I+c*M;e[15]=w*B+v*F+x*J+c*d;return this},multiplyToArray:function(a,b,c){var d=this.elements;this.multiplyMatrices(a,
b);c[0]=d[0];c[1]=d[1];c[2]=d[2];c[3]=d[3];c[4]=d[4];c[5]=d[5];c[6]=d[6];c[7]=d[7];c[8]=d[8];c[9]=d[9];c[10]=d[10];c[11]=d[11];c[12]=d[12];c[13]=d[13];c[14]=d[14];c[15]=d[15];return this},multiplyScalar:function(a){var b=this.elements;b[0]*=a;b[4]*=a;b[8]*=a;b[12]*=a;b[1]*=a;b[5]*=a;b[9]*=a;b[13]*=a;b[2]*=a;b[6]*=a;b[10]*=a;b[14]*=a;b[3]*=a;b[7]*=a;b[11]*=a;b[15]*=a;return this},applyToVector3Array:function(){var a;return function(b,c,d){void 0===a&&(a=new THREE.Vector3);void 0===c&&(c=0);void 0===
d&&(d=b.length);for(var e=0;e<d;e+=3,c+=3)a.fromArray(b,c),a.applyMatrix4(this),a.toArray(b,c);return b}}(),applyToBuffer:function(){var a;return function(b,c,d){void 0===a&&(a=new THREE.Vector3);void 0===c&&(c=0);void 0===d&&(d=b.length/b.itemSize);for(var e=0;e<d;e++,c++)a.x=b.getX(c),a.y=b.getY(c),a.z=b.getZ(c),a.applyMatrix4(this),b.setXYZ(a.x,a.y,a.z);return b}}(),determinant:function(){var a=this.elements,b=a[0],c=a[4],d=a[8],e=a[12],g=a[1],f=a[5],h=a[9],k=a[13],l=a[2],m=a[6],n=a[10],p=a[14];
return a[3]*(+e*h*m-d*k*m-e*f*n+c*k*n+d*f*p-c*h*p)+a[7]*(+b*h*p-b*k*n+e*g*n-d*g*p+d*k*l-e*h*l)+a[11]*(+b*k*m-b*f*p-e*g*m+c*g*p+e*f*l-c*k*l)+a[15]*(-d*f*l-b*h*m+b*f*n+d*g*m-c*g*n+c*h*l)},transpose:function(){var a=this.elements,b;b=a[1];a[1]=a[4];a[4]=b;b=a[2];a[2]=a[8];a[8]=b;b=a[6];a[6]=a[9];a[9]=b;b=a[3];a[3]=a[12];a[12]=b;b=a[7];a[7]=a[13];a[13]=b;b=a[11];a[11]=a[14];a[14]=b;return this},flattenToArrayOffset:function(a,b){var c=this.elements;a[b]=c[0];a[b+1]=c[1];a[b+2]=c[2];a[b+3]=c[3];a[b+4]=
c[4];a[b+5]=c[5];a[b+6]=c[6];a[b+7]=c[7];a[b+8]=c[8];a[b+9]=c[9];a[b+10]=c[10];a[b+11]=c[11];a[b+12]=c[12];a[b+13]=c[13];a[b+14]=c[14];a[b+15]=c[15];return a},getPosition:function(){var a;return function(){void 0===a&&(a=new THREE.Vector3);console.warn("THREE.Matrix4: .getPosition() has been removed. Use Vector3.setFromMatrixPosition( matrix ) instead.");var b=this.elements;return a.set(b[12],b[13],b[14])}}(),setPosition:function(a){var b=this.elements;b[12]=a.x;b[13]=a.y;b[14]=a.z;return this},getInverse:function(a,
b){var c=this.elements,d=a.elements,e=d[0],g=d[4],f=d[8],h=d[12],k=d[1],l=d[5],m=d[9],n=d[13],p=d[2],q=d[6],t=d[10],u=d[14],r=d[3],w=d[7],v=d[11],d=d[15];c[0]=m*u*w-n*t*w+n*q*v-l*u*v-m*q*d+l*t*d;c[4]=h*t*w-f*u*w-h*q*v+g*u*v+f*q*d-g*t*d;c[8]=f*n*w-h*m*w+h*l*v-g*n*v-f*l*d+g*m*d;c[12]=h*m*q-f*n*q-h*l*t+g*n*t+f*l*u-g*m*u;c[1]=n*t*r-m*u*r-n*p*v+k*u*v+m*p*d-k*t*d;c[5]=f*u*r-h*t*r+h*p*v-e*u*v-f*p*d+e*t*d;c[9]=h*m*r-f*n*r-h*k*v+e*n*v+f*k*d-e*m*d;c[13]=f*n*p-h*m*p+h*k*t-e*n*t-f*k*u+e*m*u;c[2]=l*u*r-n*q*r+
n*p*w-k*u*w-l*p*d+k*q*d;c[6]=h*q*r-g*u*r-h*p*w+e*u*w+g*p*d-e*q*d;c[10]=g*n*r-h*l*r+h*k*w-e*n*w-g*k*d+e*l*d;c[14]=h*l*p-g*n*p-h*k*q+e*n*q+g*k*u-e*l*u;c[3]=m*q*r-l*t*r-m*p*w+k*t*w+l*p*v-k*q*v;c[7]=g*t*r-f*q*r+f*p*w-e*t*w-g*p*v+e*q*v;c[11]=f*l*r-g*m*r-f*k*w+e*m*w+g*k*v-e*l*v;c[15]=g*m*p-f*l*p+f*k*q-e*m*q-g*k*t+e*l*t;c=e*c[0]+k*c[4]+p*c[8]+r*c[12];if(0===c){if(b)throw Error("THREE.Matrix4.getInverse(): can't invert matrix, determinant is 0");console.warn("THREE.Matrix4.getInverse(): can't invert matrix, determinant is 0");
this.identity();return this}this.multiplyScalar(1/c);return this},scale:function(a){var b=this.elements,c=a.x,d=a.y;a=a.z;b[0]*=c;b[4]*=d;b[8]*=a;b[1]*=c;b[5]*=d;b[9]*=a;b[2]*=c;b[6]*=d;b[10]*=a;b[3]*=c;b[7]*=d;b[11]*=a;return this},getMaxScaleOnAxis:function(){var a=this.elements;return Math.sqrt(Math.max(a[0]*a[0]+a[1]*a[1]+a[2]*a[2],a[4]*a[4]+a[5]*a[5]+a[6]*a[6],a[8]*a[8]+a[9]*a[9]+a[10]*a[10]))},makeTranslation:function(a,b,c){this.set(1,0,0,a,0,1,0,b,0,0,1,c,0,0,0,1);return this},makeRotationX:function(a){var b=
Math.cos(a);a=Math.sin(a);this.set(1,0,0,0,0,b,-a,0,0,a,b,0,0,0,0,1);return this},makeRotationY:function(a){var b=Math.cos(a);a=Math.sin(a);this.set(b,0,a,0,0,1,0,0,-a,0,b,0,0,0,0,1);return this},makeRotationZ:function(a){var b=Math.cos(a);a=Math.sin(a);this.set(b,-a,0,0,a,b,0,0,0,0,1,0,0,0,0,1);return this},makeRotationAxis:function(a,b){var c=Math.cos(b),d=Math.sin(b),e=1-c,g=a.x,f=a.y,h=a.z,k=e*g,l=e*f;this.set(k*g+c,k*f-d*h,k*h+d*f,0,k*f+d*h,l*f+c,l*h-d*g,0,k*h-d*f,l*h+d*g,e*h*h+c,0,0,0,0,1);
return this},makeScale:function(a,b,c){this.set(a,0,0,0,0,b,0,0,0,0,c,0,0,0,0,1);return this},compose:function(a,b,c){this.makeRotationFromQuaternion(b);this.scale(c);this.setPosition(a);return this},decompose:function(){var a,b;return function(c,d,e){void 0===a&&(a=new THREE.Vector3);void 0===b&&(b=new THREE.Matrix4);var g=this.elements,f=a.set(g[0],g[1],g[2]).length(),h=a.set(g[4],g[5],g[6]).length(),k=a.set(g[8],g[9],g[10]).length();0>this.determinant()&&(f=-f);c.x=g[12];c.y=g[13];c.z=g[14];b.elements.set(this.elements);
c=1/f;var g=1/h,l=1/k;b.elements[0]*=c;b.elements[1]*=c;b.elements[2]*=c;b.elements[4]*=g;b.elements[5]*=g;b.elements[6]*=g;b.elements[8]*=l;b.elements[9]*=l;b.elements[10]*=l;d.setFromRotationMatrix(b);e.x=f;e.y=h;e.z=k;return this}}(),makeFrustum:function(a,b,c,d,e,g){var f=this.elements;f[0]=2*e/(b-a);f[4]=0;f[8]=(b+a)/(b-a);f[12]=0;f[1]=0;f[5]=2*e/(d-c);f[9]=(d+c)/(d-c);f[13]=0;f[2]=0;f[6]=0;f[10]=-(g+e)/(g-e);f[14]=-2*g*e/(g-e);f[3]=0;f[7]=0;f[11]=-1;f[15]=0;return this},makePerspective:function(a,
b,c,d){a=c*Math.tan(THREE.Math.degToRad(.5*a));var e=-a;return this.makeFrustum(e*b,a*b,e,a,c,d)},makeOrthographic:function(a,b,c,d,e,g){var f=this.elements,h=b-a,k=c-d,l=g-e;f[0]=2/h;f[4]=0;f[8]=0;f[12]=-((b+a)/h);f[1]=0;f[5]=2/k;f[9]=0;f[13]=-((c+d)/k);f[2]=0;f[6]=0;f[10]=-2/l;f[14]=-((g+e)/l);f[3]=0;f[7]=0;f[11]=0;f[15]=1;return this},equals:function(a){var b=this.elements;a=a.elements;for(var c=0;16>c;c++)if(b[c]!==a[c])return!1;return!0},fromArray:function(a){this.elements.set(a);return this},
toArray:function(){var a=this.elements;return[a[0],a[1],a[2],a[3],a[4],a[5],a[6],a[7],a[8],a[9],a[10],a[11],a[12],a[13],a[14],a[15]]}};THREE.Vector3=function(a,b,c){this.x=a||0;this.y=b||0;this.z=c||0};
THREE.Vector3.prototype={constructor:THREE.Vector3,set:function(a,b,c){this.x=a;this.y=b;this.z=c;return this},setScalar:function(a){this.z=this.y=this.x=a;return this},setX:function(a){this.x=a;return this},setY:function(a){this.y=a;return this},setZ:function(a){this.z=a;return this},setComponent:function(a,b){switch(a){case 0:this.x=b;break;case 1:this.y=b;break;case 2:this.z=b;break;default:throw Error("index is out of range: "+a);}},getComponent:function(a){switch(a){case 0:return this.x;case 1:return this.y;
case 2:return this.z;default:throw Error("index is out of range: "+a);}},clone:function(){return new this.constructor(this.x,this.y,this.z)},copy:function(a){this.x=a.x;this.y=a.y;this.z=a.z;return this},add:function(a,b){if(void 0!==b)return console.warn("THREE.Vector3: .add() now only accepts one argument. Use .addVectors( a, b ) instead."),this.addVectors(a,b);this.x+=a.x;this.y+=a.y;this.z+=a.z;return this},addScalar:function(a){this.x+=a;this.y+=a;this.z+=a;return this},addVectors:function(a,
b){this.x=a.x+b.x;this.y=a.y+b.y;this.z=a.z+b.z;return this},addScaledVector:function(a,b){this.x+=a.x*b;this.y+=a.y*b;this.z+=a.z*b;return this},sub:function(a,b){if(void 0!==b)return console.warn("THREE.Vector3: .sub() now only accepts one argument. Use .subVectors( a, b ) instead."),this.subVectors(a,b);this.x-=a.x;this.y-=a.y;this.z-=a.z;return this},subScalar:function(a){this.x-=a;this.y-=a;this.z-=a;return this},subVectors:function(a,b){this.x=a.x-b.x;this.y=a.y-b.y;this.z=a.z-b.z;return this},
multiply:function(a,b){if(void 0!==b)return console.warn("THREE.Vector3: .multiply() now only accepts one argument. Use .multiplyVectors( a, b ) instead."),this.multiplyVectors(a,b);this.x*=a.x;this.y*=a.y;this.z*=a.z;return this},multiplyScalar:function(a){isFinite(a)?(this.x*=a,this.y*=a,this.z*=a):this.z=this.y=this.x=0;return this},multiplyVectors:function(a,b){this.x=a.x*b.x;this.y=a.y*b.y;this.z=a.z*b.z;return this},applyEuler:function(){var a;return function(b){!1===b instanceof THREE.Euler&&
console.error("THREE.Vector3: .applyEuler() now expects an Euler rotation rather than a Vector3 and order.");void 0===a&&(a=new THREE.Quaternion);this.applyQuaternion(a.setFromEuler(b));return this}}(),applyAxisAngle:function(){var a;return function(b,c){void 0===a&&(a=new THREE.Quaternion);this.applyQuaternion(a.setFromAxisAngle(b,c));return this}}(),applyMatrix3:function(a){var b=this.x,c=this.y,d=this.z;a=a.elements;this.x=a[0]*b+a[3]*c+a[6]*d;this.y=a[1]*b+a[4]*c+a[7]*d;this.z=a[2]*b+a[5]*c+a[8]*
d;return this},applyMatrix4:function(a){var b=this.x,c=this.y,d=this.z;a=a.elements;this.x=a[0]*b+a[4]*c+a[8]*d+a[12];this.y=a[1]*b+a[5]*c+a[9]*d+a[13];this.z=a[2]*b+a[6]*c+a[10]*d+a[14];return this},applyProjection:function(a){var b=this.x,c=this.y,d=this.z;a=a.elements;var e=1/(a[3]*b+a[7]*c+a[11]*d+a[15]);this.x=(a[0]*b+a[4]*c+a[8]*d+a[12])*e;this.y=(a[1]*b+a[5]*c+a[9]*d+a[13])*e;this.z=(a[2]*b+a[6]*c+a[10]*d+a[14])*e;return this},applyQuaternion:function(a){var b=this.x,c=this.y,d=this.z,e=a.x,
g=a.y,f=a.z;a=a.w;var h=a*b+g*d-f*c,k=a*c+f*b-e*d,l=a*d+e*c-g*b,b=-e*b-g*c-f*d;this.x=h*a+b*-e+k*-f-l*-g;this.y=k*a+b*-g+l*-e-h*-f;this.z=l*a+b*-f+h*-g-k*-e;return this},project:function(){var a;return function(b){void 0===a&&(a=new THREE.Matrix4);a.multiplyMatrices(b.projectionMatrix,a.getInverse(b.matrixWorld));return this.applyProjection(a)}}(),unproject:function(){var a;return function(b){void 0===a&&(a=new THREE.Matrix4);a.multiplyMatrices(b.matrixWorld,a.getInverse(b.projectionMatrix));return this.applyProjection(a)}}(),
transformDirection:function(a){var b=this.x,c=this.y,d=this.z;a=a.elements;this.x=a[0]*b+a[4]*c+a[8]*d;this.y=a[1]*b+a[5]*c+a[9]*d;this.z=a[2]*b+a[6]*c+a[10]*d;this.normalize();return this},divide:function(a){this.x/=a.x;this.y/=a.y;this.z/=a.z;return this},divideScalar:function(a){return this.multiplyScalar(1/a)},min:function(a){this.x=Math.min(this.x,a.x);this.y=Math.min(this.y,a.y);this.z=Math.min(this.z,a.z);return this},max:function(a){this.x=Math.max(this.x,a.x);this.y=Math.max(this.y,a.y);
this.z=Math.max(this.z,a.z);return this},clamp:function(a,b){this.x=Math.max(a.x,Math.min(b.x,this.x));this.y=Math.max(a.y,Math.min(b.y,this.y));this.z=Math.max(a.z,Math.min(b.z,this.z));return this},clampScalar:function(){var a,b;return function(c,d){void 0===a&&(a=new THREE.Vector3,b=new THREE.Vector3);a.set(c,c,c);b.set(d,d,d);return this.clamp(a,b)}}(),clampLength:function(a,b){var c=this.length();this.multiplyScalar(Math.max(a,Math.min(b,c))/c);return this},floor:function(){this.x=Math.floor(this.x);
this.y=Math.floor(this.y);this.z=Math.floor(this.z);return this},ceil:function(){this.x=Math.ceil(this.x);this.y=Math.ceil(this.y);this.z=Math.ceil(this.z);return this},round:function(){this.x=Math.round(this.x);this.y=Math.round(this.y);this.z=Math.round(this.z);return this},roundToZero:function(){this.x=0>this.x?Math.ceil(this.x):Math.floor(this.x);this.y=0>this.y?Math.ceil(this.y):Math.floor(this.y);this.z=0>this.z?Math.ceil(this.z):Math.floor(this.z);return this},negate:function(){this.x=-this.x;
this.y=-this.y;this.z=-this.z;return this},dot:function(a){return this.x*a.x+this.y*a.y+this.z*a.z},lengthSq:function(){return this.x*this.x+this.y*this.y+this.z*this.z},length:function(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z)},lengthManhattan:function(){return Math.abs(this.x)+Math.abs(this.y)+Math.abs(this.z)},normalize:function(){return this.divideScalar(this.length())},setLength:function(a){return this.multiplyScalar(a/this.length())},lerp:function(a,b){this.x+=(a.x-this.x)*
b;this.y+=(a.y-this.y)*b;this.z+=(a.z-this.z)*b;return this},lerpVectors:function(a,b,c){this.subVectors(b,a).multiplyScalar(c).add(a);return this},cross:function(a,b){if(void 0!==b)return console.warn("THREE.Vector3: .cross() now only accepts one argument. Use .crossVectors( a, b ) instead."),this.crossVectors(a,b);var c=this.x,d=this.y,e=this.z;this.x=d*a.z-e*a.y;this.y=e*a.x-c*a.z;this.z=c*a.y-d*a.x;return this},crossVectors:function(a,b){var c=a.x,d=a.y,e=a.z,g=b.x,f=b.y,h=b.z;this.x=d*h-e*f;
this.y=e*g-c*h;this.z=c*f-d*g;return this},projectOnVector:function(){var a,b;return function(c){void 0===a&&(a=new THREE.Vector3);a.copy(c).normalize();b=this.dot(a);return this.copy(a).multiplyScalar(b)}}(),projectOnPlane:function(){var a;return function(b){void 0===a&&(a=new THREE.Vector3);a.copy(this).projectOnVector(b);return this.sub(a)}}(),reflect:function(){var a;return function(b){void 0===a&&(a=new THREE.Vector3);return this.sub(a.copy(b).multiplyScalar(2*this.dot(b)))}}(),angleTo:function(a){a=
this.dot(a)/Math.sqrt(this.lengthSq()*a.lengthSq());return Math.acos(THREE.Math.clamp(a,-1,1))},distanceTo:function(a){return Math.sqrt(this.distanceToSquared(a))},distanceToSquared:function(a){var b=this.x-a.x,c=this.y-a.y;a=this.z-a.z;return b*b+c*c+a*a},setFromMatrixPosition:function(a){this.x=a.elements[12];this.y=a.elements[13];this.z=a.elements[14];return this},setFromMatrixScale:function(a){var b=this.set(a.elements[0],a.elements[1],a.elements[2]).length(),c=this.set(a.elements[4],a.elements[5],
a.elements[6]).length();a=this.set(a.elements[8],a.elements[9],a.elements[10]).length();this.x=b;this.y=c;this.z=a;return this},setFromMatrixColumn:function(a,b){var c=4*a,d=b.elements;this.x=d[c];this.y=d[c+1];this.z=d[c+2];return this},equals:function(a){return a.x===this.x&&a.y===this.y&&a.z===this.z},fromArray:function(a,b){void 0===b&&(b=0);this.x=a[b];this.y=a[b+1];this.z=a[b+2];return this},toArray:function(a,b){void 0===a&&(a=[]);void 0===b&&(b=0);a[b]=this.x;a[b+1]=this.y;a[b+2]=this.z;return a},
fromAttribute:function(a,b,c){void 0===c&&(c=0);b=b*a.itemSize+c;this.x=a.array[b];this.y=a.array[b+1];this.z=a.array[b+2];return this}};KEPLER.Vector3=THREE.Vector3;KEPLER.Matrix4=THREE.Matrix4;
KEPLER.AstroBody=function(a,b,c){this.id=a;this.mass=b;Object.defineProperties(this,{orbit:{enumerable:!0,value:c}});this.satellites=[];this.primary=c.primary;this.primary.addSatellite(this);this.getElements=function(){return c.getElements()};this.getPosition=function(){return c.getPosition()};this.getVelocity=function(){return c.getVelocity()};this.addTime=function(){return c.addTime()};this.subTime=function(){return c.subTime()};this.clone=function(){var a=this.getElements(),b=this.id,c=this.mass,
f=this.satellites,a=new KEPLER.Orbit(this.primary,a.a,a.ecc,a.mAnomaly,a.rotI,a.rotW,a.rotOmeg),h=new KEPLER.AstroBody(b,c,a);f.forEach(function(a){h.addSatellite(a.clone())});return h};this.addSatellite=function(a){this.satellites.push(a)};this.removeSatellite=function(a){this.satellites=this.satellites.filter(function(b){return b!==a})}};
KEPLER.Orbit=function(a,b,c,d,e,g,f){this.primary=a;var h=KEPLER.G*this.primary.mass,k=0,l=0,m=0,n=0,p=0,q=0,t=0,u=function(){if(1>c)return(1-c)*b;if(1===c)return b;if(1<c)return(1-c)*b},r=function(){if(0===c)return d;if(1>c){t=v();var a=2*Math.atan2(Math.sqrt(1+c)*Math.sin(t/2),Math.sqrt(1-c)*Math.cos(t/2));return a}if(1===c)return a=1.5*d,a=Math.cbrt(a+Math.sqrt(a*a+1)),a=2*Math.atan(a-1/a);if(1<=c)return t=v(),a=2*Math.atanh(Math.sqrt(1+c)*Math.sin(t/2)/Math.sqrt(1-c)*Math.cos(t/2))},w=function(){if(1>
c)return Math.pow(b*b*b/h,.5)*d;if(1===c)return Math.pow(2*b*b*b/h,.5)*d;if(1<c)return Math.pow(-b*-b*-b/h,.5)*d},v=function(){if(0===c)return d;if(1>c){for(var a=d,b=a,e=0;1E-10<Math.abs(b-c*Math.sin(b)-a);)if(b-=(b-c*Math.sin(b)-a)/(1-c*Math.cos(b)),e++,1E3<=e)throw"took too long to determine E for "+this.id;return b}if(1===c)return p=r(),Math.tan(p/2);if(1<c){b=a=d;for(e=0;1E-10<Math.abs(c*Math.sinh(b)-b-a);)if(b-=(c*Math.sinh(b)-b-a)/(c*Math.cosh(b)-1),e++,1E3<=e)throw"took too long to determine E for "+
this.id;return b}};this.updateElement={peri:function(){return k=u()},apo:function(){l=1>c?(1+c)*b:1<=c?Infinity:void 0;return l},T:function(){m=1>c?2*KEPLER.PI*Math.pow(b*b*b/h,.5):1<=c?Infinity:void 0;return m},meanMotion:function(){n=1>c?Math.pow(b*b*b/h,-.5):1<=c?Infinity:void 0;return n},tAnomaly:function(){return p=r()},periT:function(){return q=w()},E:function(){return t=v()}};this.updateAllElements=function(){this.updateElement.peri();this.updateElement.apo();this.updateElement.T();this.updateElement.meanMotion();
this.updateElement.tAnomaly();this.updateElement.periT();this.updateElement.E()};this.getElements=function(){this.updateAllElements();return{a:b,ecc:c,mAnomaly:d,rotI:e,rotW:g,rotOmeg:f,mu:h,peri:k,apo:l,T:m,meanMotion:n,tAnomaly:p,periT:q,E:t}};var x=function(a){var b=new KEPLER.Vector3(0,0,1),b=(new KEPLER.Matrix4).makeRotationAxis(b,-g);a.applyMatrix4(b);b=new KEPLER.Vector3(1,0,0);b=(new KEPLER.Matrix4).makeRotationAxis(b,-e);a.applyMatrix4(b);b=new KEPLER.Vector3(0,0,1);b=(new KEPLER.Matrix4).makeRotationAxis(b,
-f);a.applyMatrix4(b);return a};this.getPosition=function(){this.updateElement.E();var a=new KEPLER.Vector3(b*Math.cos(t)-b*c,b*Math.sqrt(1-c*c)*Math.sin(t),0),a=x(a);a.add(this.primary.getPosition());return a};this.getVelocity=function(){this.updateElement.E();this.updateElement.meanMotion();var a=new KEPLER.Vector3(n*b/(1-c*Math.cos(t))*-Math.sin(t),n*b/(1-c*Math.cos(t))*Math.sqrt(1-c*c)*Math.cos(t),0),a=x(a);a.add(this.primary.getVelocity());return a};this.clone=function(){this.updateAllElements();
var a=this.getElements();return new KEPLER.Orbit(this.primary,a.a,a.ecc,a.mAnomaly,a.rotI,a.rotW,a.rotOmeg)};this.addTime=function(a){this.updateElement.meanMotion();d=((d+a*n%(2*KEPLER.PI))%(2*KEPLER.PI)+2*KEPLER.PI)%(2*KEPLER.PI);this.updateAllElements();return this};this.subTime=function(a){return this.addTime(-a)};this.addVelocity=function(a){var k=this.getPosition(),l=this.getVelocity();l.add(a);var m=k.clone(),n=l.clone();a=new KEPLER.Vector3(0,0,0);a.crossVectors(k,l);var p=Math.atan(a.x/-a.y),
q=Math.atan(Math.sqrt(a.x*a.x+a.y*a.y)/a.z),r=new THREE.Vector3(0,0,0);r.copy(m);var t=new THREE.Vector3(0,0,1),p=(new THREE.Matrix4).makeRotationAxis(t,p);r.applyMatrix4(p);p=new THREE.Vector3(1,0,0);q=(new THREE.Matrix4).makeRotationAxis(p,q);r.applyMatrix4(q);m=m.length();n=n.length();a=a.length();n=h*m/(2*h-m*n*n);a=Math.sqrt(1-a*a/(h*n));k.dot(l);k={a:n,ecc:a,mAnomaly:d,rotI:e,rotW:g,rotOmeg:f};b=k.a;c=k.ecc;d=k.mAnomaly;e=k.rotI;g=k.rotW;f=k.rotOmeg;this.updateAllElements();return k}};
KEPLER.NULL_ORBIT=function(){this.primary={mass:1};KEPLER.Orbit.call(this,this.primary,0,0,0,0,0,0);this.getPosition=function(){return new KEPLER.Vector3(0,0,0)};this.getVelocity=function(){return new KEPLER.Vector3(0,0,0)};this.primary.addSatellite=function(a){};this.primary.removeSatellite=function(a){};this.updateAllElements()};KEPLER.NULL_ORBIT.prototype=Object.create(KEPLER.Orbit.prototype);
KEPLER.Spacecraft=function(a,b,c,d,e){KEPLER.AstroBody.call(this,a,b,e);this.deltaV=this.fuel=0;this.addFuel=function(a){var b=this.fuel.value;if(b+a>c)throw"Cannot add more fuel to "+this.id+", fuel Capacity Exceeded. Fuel Tank Size: "+c+" kg";if(0>b+a)throw"Cannot subtract fuel from "+this.id+", insufficient fuel";this.fuel=b+a;this.updateDeltaV();return!0};this.subFuel=function(a){this.addFuel(-a);return!0};this.subDeltaV=function(a){if(0>this.deltaV.value-a)throw"Cannot subtract deltaV from "+
this.id+", insufficient deltaV";this.subFuel((this.mass+this.fuel)*(1-1/Math.exp(a/this.exhaustVEff)));return!0};this.updateDeltaV=function(){var a=this.mass;this.deltaV=this.exhaustVEff*Math.log((a+this.fuel)/a);return!0}};KEPLER.Spacecraft.prototype=Object.create(KEPLER.AstroBody.prototype);
KEPLER.Transfer=function(a,b,c){if(a.primary!==b.primary)throw"Cannot create Transfer from Orbiting "+a.primary+" to orbiting "+b.primary;var d=KEPLER.Lambert(a,b,c);if(-1===d)return-1;a=a.clone();b=b.clone();b.addTime(c);var e=a.getVelocity(),g=b.getVelocity(),f=d.departure.clone();f.sub(e);var h=d.arrival.clone();h.sub(g);var k=f.length()+h.length();return{object1:a,object2:b,object1_v:e,object2_v:g,duration:c,vector1:d.departure,vector2:d.arrival,thrust1:f,thrust2:h,delta_v:k}};
KEPLER.Lambert=function(a,b,c){if(a.primary!==b.primary)throw"Cannot use lambert solver to find path from Orbiting "+a.primary+" to orbiting "+b.primary;var d=a.clone();b=b.clone();b.addTime(c);d=d.getPosition();b=b.getPosition();var e=d.length(),g=b.length(),f=1*Math.sqrt(e*g+d.dot(b));if(0===f)return 0;var h=0,k=.5,l=1/6,m=4*Math.PI*Math.PI,n=-4*Math.PI,p=0,q=0,t=0,u=0;for(a=a.getElements().mu;1<Math.abs(p-c);)if(q=e+g+f*(h*l-1)/Math.sqrt(k),0<f&&0>q&&(q=0),t=Math.sqrt(q/k),p=(Math.pow(t,3)*l+f*
Math.sqrt(q))/Math.sqrt(a),p<=c?n=h:m=h,h=(m+n)/2,1E-6<h?(k=(1-Math.cos(Math.sqrt(h)))/h,l=(Math.sqrt(h)-Math.sin(Math.sqrt(h)))/Math.pow(h,1.5)):-1E-6>h?(k=(1-Math.cosh(Math.sqrt(-h)))/h,l=(Math.sinh(Math.sqrt(-h))-Math.sqrt(-h))/Math.pow(-h,1.5)):(k=.5,l=1/6),u++,150<u)return-1;e=1-q/e;c=1-q/g;a=f*Math.sqrt(q/a);f=new THREE.Vector3(0,0,0);q=new THREE.Vector3(0,0,0);q.copy(d);q.multiplyScalar(e);f.subVectors(b,q).divideScalar(a);q=new THREE.Vector3(0,0,0);g=new THREE.Vector3(0,0,0);g.copy(b);g.multiplyScalar(c);
q.subVectors(g,d).divideScalar(a);return{departure:f,arrival:q}};KEPLER.TransferSolver={};KEPLER.TransferSolver.bisectionSlopeSolver=function(a,b,c,d,e){var g=0,f,h,k,l;do if(f=Math.ceil((a+b)/2),k=c(f,e),h=f+1,l=c(h,e),k=d(k,l,function(){return c(a,e)},function(){return c(b,e)}),0<k?a=f:0>k?b=f:(a=f,b=h),g++,100<g)throw"KEPLER.TransferSolver.bisectionSlopeSolver took too long to calculate using:\n"+c;while(1<b-a);return f};
KEPLER.TransferSolver.minDeltaV_LaunchSpecified=function(a,b,c){c=void 0===c?0:c;a=a.clone();b=b.clone();a.addTime(c);b.addTime(c);c=a.getElements();var d=b.getElements();c=KEPLER.TransferSolver.bisectionSlopeSolver(1,Math.max(c.T,d.T),function(a,b){return new KEPLER.Transfer(b.testArg1,b.testArg2,a)},function(a,b){return-((b.delta_v-a.delta_v)/1)},{testArg1:a,testArg2:b});return new KEPLER.Transfer(a,b,c)};
KEPLER.TransferSolver.minDeltaV=function(a,b){for(var c=a.clone(),d=b.clone(),e=c.getElements(),d=d.getElements(),g=Math.min(e.T,d.T)/8,f=Math.ceil(Math.max(e.T,d.T)/g),h=0,k=g*f,e={},l=0;l<f;l++){var h=Math.ceil(l*g),k=Math.floor((l+1)*g),c=a.clone(),d=b.clone(),m=KEPLER.TransferSolver.bisectionSlopeSolver(h,k,function(a,b){var c=new KEPLER.TransferSolver.minDeltaV_LaunchSpecified(b.testArg1,b.testArg2,a);return{waitTime:a,transfer:c}},function(a,b,c,d){return-((b.transfer.delta_v-a.transfer.delta_v)/
1)},{testArg1:c,testArg2:d});e[m]=KEPLER.TransferSolver.minDeltaV_LaunchSpecified(c,d,m)}g={waitTime:m,transfer:e[m]};for(chunk in e)e[chunk].delta_v<=g.transfer.delta_v&&(g={waitTime:chunk,transfer:e[chunk]});return g};
KEPLER.TransferSolver.minTime_LaunchSpecified=function(a,b,c,d){d=void 0===d?0:d;a=a.clone();b=b.clone();a.addTime(d);b.addTime(d);d=a.getElements();var e=b.getElements(),e=KEPLER.TransferSolver.bisectionSlopeSolver(1,Math.max(d.T,e.T),function(a,b){return new KEPLER.Transfer(b.testArg1,b.testArg2,a)},function(a,b,d,e){b=b.delta_v;a=(b-a.delta_v)/1;if(isNaN(a))return 1;if(b<c)return-1;maxXValue=e();return maxXValue.delta_v<=c?1:-a},{testArg1:a,testArg2:b});d=new KEPLER.Transfer(a,b,e);a=new KEPLER.Transfer(a,
b,e+1);return d.delta_v<=a.delta_v?d:a};
KEPLER.TransferSolver.minTime=function(a,b,c){for(var d=a.clone(),e=b.clone(),d=d.getElements(),e=e.getElements(),g=Math.min(d.T,e.T)/8,f=Math.ceil(Math.max(d.T,e.T)/g),h=0,k=g*f,l={},m=0;m<f;m++)if(h=Math.ceil(m*g),k=Math.floor((m+1)*g),d=a.clone(),e=b.clone(),h=KEPLER.TransferSolver.bisectionSlopeSolver(h,k,function(a,b){var c=KEPLER.TransferSolver.minTime_LaunchSpecified(b.testArg1,b.testArg2,b.testArg3,a);return{waitTime:a,transfer:c}},function(a,b,d,e){var f=a.transfer.delta_v,g=(b.transfer.delta_v-
f)/1;a=(b.waitTime+b.transfer.duration-(a.waitTime+a.transfer.duration))/1;if(isNaN(g))return 1;if(f<c)return-a;minXValue=d();maxXValue=e();return minXValue.delta_v<=c?-1:maxXValue.delta_v<=c?1:-g},{testArg1:d,testArg2:e,testArg3:c}),l[h]=KEPLER.TransferSolver.minTime_LaunchSpecified(d,e,c,h),l[h].delta_v<=c)return{waitTime:h,transfer:l[h]};return-1};var EXAMPLE={};EXAMPLE.Sol=new KEPLER.AstroBody("Sol",KEPLER.SOL_MASS,new KEPLER.NULL_ORBIT);
EXAMPLE.Mercury=new KEPLER.AstroBody("Mercury",3.302E23,new KEPLER.Orbit(EXAMPLE.Sol,.3870982252717257*KEPLER.AU,.2056302512089075,172.7497133778637*KEPLER.DEGREE,7.005014199657344*KEPLER.DEGREE,29.12428058698772*KEPLER.DEGREE,48.33053756455964*KEPLER.DEGREE));
EXAMPLE.Venus=new KEPLER.AstroBody("Venus",4.8685E24,new KEPLER.Orbit(EXAMPLE.Sol,.7233268496749391*KEPLER.AU,.006755697267164094,49.31425178852966*KEPLER.DEGREE,3.394589632336535*KEPLER.DEGREE,55.185414554522*KEPLER.DEGREE,76.67837563371675*KEPLER.DEGREE));
EXAMPLE.Earth=new KEPLER.AstroBody("Earth",5.97219E24,new KEPLER.Orbit(EXAMPLE.Sol,1.000371833989169*KEPLER.AU,.01704239716781501,358.1891404220149*KEPLER.DEGREE,2.669113820737183E-4*KEPLER.DEGREE,297.7668064579176*KEPLER.DEGREE,163.9752443600624*KEPLER.DEGREE));
EXAMPLE.Luna=new KEPLER.AstroBody("Luna",7.349E22,new KEPLER.Orbit(EXAMPLE.Earth,381218.6882902056*KEPLER.KM,.06476694137484437,140.7402568949268*KEPLER.DEGREE,5.240010960708354*KEPLER.DEGREE,308.135902507981*KEPLER.DEGREE,123.9837037681769*KEPLER.DEGREE));EXAMPLE.Mars=new KEPLER.AstroBody("Mars",6.4185E23,new KEPLER.Orbit(EXAMPLE.Sol,1.523678184302188*KEPLER.AU,.09331460653723893,19.0945088699962*KEPLER.DEGREE,1.84987660922101*KEPLER.DEGREE,286.5373577554387*KEPLER.DEGREE,49.56199966373916*KEPLER.DEGREE));
EXAMPLE.Phobos=new KEPLER.AstroBody("Phobos",1.08E20,new KEPLER.Orbit(EXAMPLE.Mars,9378.286882214712*KEPLER.KM,.01541577713745092,345.810365877979*KEPLER.DEGREE,26.05134469392531*KEPLER.DEGREE,342.3765589430989*KEPLER.DEGREE,84.81060423679303*KEPLER.DEGREE));
EXAMPLE.Deimos=new KEPLER.AstroBody("Deimos",1.8E20,new KEPLER.Orbit(EXAMPLE.Mars,23458.88830758717*KEPLER.KM,2.419395670375644E-4,244.1640161731743*KEPLER.DEGREE,27.57017394063173*KEPLER.DEGREE,190.2368646630796*KEPLER.DEGREE,83.6637869299841*KEPLER.DEGREE));
EXAMPLE.voyager1=new KEPLER.Spacecraft("voyager1",722,10,3369,new KEPLER.Orbit(EXAMPLE.Sol,-3.220924861390099*KEPLER.AU,3.707585664603564,1248.081698810124*KEPLER.DEGREE,35.81757543323521*KEPLER.DEGREE,337.956332715058*KEPLER.DEGREE,179.2513338910511*KEPLER.DEGREE));
EXAMPLE.iss=new KEPLER.Spacecraft("ISS",370131,0,0,new KEPLER.Orbit(EXAMPLE.Earth,6759.645260772543*KEPLER.KM,.002048033237342145,329.2219482993897*KEPLER.DEGREE,52.17497644819966*KEPLER.DEGREE,86.11226361123934*KEPLER.DEGREE,259.2819760903027*KEPLER.DEGREE));EXAMPLE.TransferISSToMoon=new KEPLER.Transfer(EXAMPLE.iss.orbit,EXAMPLE.Luna.orbit,3*KEPLER.DAY);
